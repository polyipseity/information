---
aliases:
  - inclusion–exclusion principle
  - inclusion–exclusion principles
tags:
  - flashcard/active/general/eng/inclusion-exclusion_principle
  - language/in/English
---

# inclusion–exclusion principle

In [combinatorics](combinatorics.md), a branch of [mathematics](mathematics.md), the __inclusion–exclusion principle__ is {@{a counting technique}@} which {@{generalizes the familiar method of obtaining the number of elements in the [union](union%20(set%20theory).md) of two [finite sets](finite%20set.md)}@}; symbolically expressed as {@{$$|A\cup B|=|A|+|B|-|A\cap B|$$}@} where {@{_A_ and _B_ are two finite sets and |_S_| indicates the [cardinality](cardinality.md) of a set _S_}@} (which may be {@{considered as the number of elements of the set, if the set is [finite](finite%20set.md)}@}). The formula expresses the fact that {@{the sum of the sizes of the two sets may be too large since some elements may be counted twice}@}. The double-counted elements are {@{those in the [intersection](intersection%20(set%20theory).md) of the two sets}@} and the count is {@{corrected by subtracting the size of the intersection}@}. <!--SR:!2025-12-31,349,351!2025-11-21,315,340!2025-12-24,342,351!2025-11-21,315,340!2025-12-08,327,340!2025-12-28,346,351!2025-12-24,342,351!2027-04-01,670,320-->

The inclusion-exclusion principle, being {@{a generalization of the two-set case}@}, is perhaps more clearly seen in the case of three sets, which for the sets _A_, _B_ and _C_ is given by {@{$$|A\cup B\cup C|=|A|+|B|+|C|-|A\cap B|-|A\cap C|-|B\cap C|+|A\cap B\cap C|$$}@} This formula can be verified by {@{counting how many times each region in the [Venn diagram](Venn%20diagram.md) figure is included in the right-hand side of the formula}@}. In this case, when {@{removing the contributions of over-counted elements}@}, the number of elements in {@{the mutual intersection of the three sets has been subtracted too often}@}, so {@{must be added back in to get the correct total}@}. <!--SR:!2025-11-16,310,340!2026-01-02,351,351!2025-12-25,343,351!2025-11-11,305,330!2026-01-01,350,351!2025-12-26,345,351-->

{@{Generalizing the results of these examples}@} gives the principle of inclusion–exclusion. To {@{find the cardinality of the union of _n_ sets}@}: <!--SR:!2025-12-13,332,340!2025-12-31,349,351-->

1. Include the cardinalities of the sets.
2. Exclude the cardinalities of the pairwise intersections.
3. Include the cardinalities of the triple-wise intersections.
4. Exclude the cardinalities of the quadruple-wise intersections.
5. Include the cardinalities of the quintuple-wise intersections.
6. Continue, until the cardinality of the _n_-tuple-wise intersection is included (if _n_ is odd) or excluded (_n_ even).

The name comes from the idea that {@{the principle is based on over-generous _inclusion_, followed by compensating _exclusion_}@}. This concept is attributed to [Abraham de Moivre](Abraham%20de%20Moivre.md) (1718),<sup>[\[1\]](#^ref-1)</sup> although it first appears in a paper of [Daniel da Silva](Daniel%20da%20Silva%20(mathematician).md) (1854)<sup>[\[2\]](#^ref-2)</sup> and later in a paper by [J. J. Sylvester](James%20Joseph%20Sylvester.md) (1883).<sup>[\[3\]](#^ref-3)</sup> Sometimes the principle is referred to as the formula of Da Silva or Sylvester, due to these publications. The principle can be viewed as {@{an example of the [sieve method](sieve%20theory.md) extensively used in [number theory](number%20theory.md) and is sometimes referred to as the _sieve formula_}@}.<sup>[\[4\]](#^ref-4)</sup> <!--SR:!2025-12-30,348,351!2025-09-25,253,331-->

As {@{finite probabilities are computed as counts relative to the cardinality of the [probability space](probability%20space.md)}@}, the formulas for the principle of inclusion–exclusion {@{remain valid when the cardinalities of the sets are replaced by finite probabilities}@}. More generally, both versions of the principle can be {@{put under the common umbrella of [measure theory](measure%20(mathematics).md)}@}. <!--SR:!2026-01-01,350,351!2025-11-09,303,330!2025-12-21,340,351-->

In a very abstract setting, the principle of inclusion–exclusion can be expressed as {@{the calculation of the inverse of a certain matrix}@}.<sup>[\[5\]](#^ref-5)</sup> This inverse has {@{a special structure}@}, making the principle {@{an extremely valuable technique in combinatorics and related areas of mathematics}@}. As [Gian-Carlo Rota](Gian-Carlo%20Rota.md) put it:<sup>[\[6\]](#^ref-6)</sup> <!--SR:!2025-12-30,348,351!2025-12-07,326,340!2027-05-01,694,320-->

> "One of the most useful principles of enumeration in discrete probability and combinatorial theory is the celebrated principle of inclusion–exclusion. When skillfully applied, this principle has yielded the solution to many a combinatorial problem."

## formula

In its general formula, the principle of inclusion–exclusion states that for {@{finite sets _A_<sub>1</sub>, ..., _A<sub>n</sub>_}@}, one has {@{the identity $$\left|\bigcup _{i=1}^{n}A_{i}\right|=\sum _{i=1}^{n}|A_{i}|-\sum _{1\leqslant i<j\leqslant n}|A_{i}\cap A_{j}|+\sum _{1\leqslant i<j<k\leqslant n}|A_{i}\cap A_{j}\cap A_{k}|-\cdots +(-1)^{n+1}\left|A_{1}\cap \cdots \cap A_{n}\right|. \qquad \textbf{(1)}$$ <a id="math_1"></a>}@} This can be compactly written as {@{$$\left|\bigcup _{i=1}^{n}A_{i}\right|=\sum _{k=1}^{n}(-1)^{k+1}\left(\sum _{1\leqslant i_{1}<\cdots <i_{k}\leqslant n}|A_{i_{1} }\cap \cdots \cap A_{i_{k} }|\right)$$}@} or {@{$$\left|\bigcup _{i=1}^{n}A_{i}\right|=\sum _{\emptyset \neq J\subseteq \{1,\ldots ,n\} }(-1)^{|J|+1}\left|\bigcap _{j\in J}A_{j}\right|.$$}@} In words, to {@{count the number of elements in a finite union of finite sets}@}, first {@{sum the cardinalities of the individual sets, then subtract the number of elements that appear in at least two sets, then add back the number of elements that appear in at least three sets, then subtract the number of elements that appear in at least four sets, and so on}@}. This process always {@{ends since there can be no elements that appear in more than the number of sets in the union}@}. (For example, if $n=4,$ there can be no elements that appear in more than $4$ sets; equivalently, there can be no elements that appear in at least $5$ sets.) <!--SR:!2025-11-19,313,340!2027-05-12,718,331!2025-12-17,298,300!2025-12-23,342,351!2025-11-22,316,340!2025-12-24,343,351!2025-11-20,314,340-->

In applications it is common to see {@{the principle expressed in its complementary form}@}. That is, letting {@{_S_ be a finite [universal set](universal%20set.md) containing all of the _A<sub>i</sub>_ and letting ${\bar {A_{i} } }$ denote the complement of _A<sub>i</sub>_ in _S_}@}, by {@{[De Morgan's laws](De%20Morgan's%20laws.md)}@} we have {@{$$\left|\bigcap _{i=1}^{n}{\bar {A_{i} } }\right|=\left|S-\bigcup _{i=1}^{n}A_{i}\right|=|S|-\sum _{i=1}^{n}|A_{i}|+\sum _{1\leqslant i<j\leqslant n}|A_{i}\cap A_{j}|-\cdots +(-1)^{n}|A_{1}\cap \cdots \cap A_{n}|.$$}@} As another variant of the statement, let {@{_P_<sub>1</sub>, ..., _P<sub>n</sub>_ be a list of properties that elements of a set _S_ may or may not have}@}, then the principle of inclusion–exclusion provides a way to {@{calculate the number of elements of _S_ that have none of the properties}@}. Just let {@{_A<sub>i</sub>_ be the subset of elements of _S_ which have the property _P<sub>i</sub>_ and use the principle in its complementary form}@}. This variant is due to [J. J. Sylvester](James%20Joseph%20Sylvester.md).<sup>[\[1\]](#^ref-1)</sup> <!--SR:!2026-01-01,350,351!2026-01-04,353,351!2025-11-10,304,330!2025-12-29,347,351!2025-12-22,341,351!2025-12-29,347,351!2028-08-01,1081,351-->

Notice that if {@{you take into account only the first _m<n_ sums on the right (in the general form of the principle)}@}, then {@{you will get an overestimate if _m_ is odd and an underestimate if _m_ is even}@}. <!--SR:!2026-01-04,353,351!2028-03-04,931,330-->

## examples

### counting derangements

A more complex example is the following.

Suppose there is {@{a deck of _n_ cards numbered from 1 to _n_}@}. Suppose a card numbered _m_ is {@{in the correct position if it is the _m<sup>th</sup>_ card in the deck}@}. How many ways, _W_, can {@{the cards be shuffled with at least 1 card being in the correct position}@}? <!--SR:!2025-11-16,310,340!2025-11-18,312,340!2025-11-17,311,340-->

Begin by {@{defining set _A_<sub>_m_</sub>, which is all of the orderings of cards with the _m<sup>th</sup>_ card correct}@}. Then {@{the number of orders, _W_, with _at least_ one card being in the correct position, _m_}@}, is {@{$$W=\left|\bigcup _{m=1}^{n}A_{m}\right|.$$}@} Apply the principle of inclusion–exclusion, {@{$$W=\sum _{m_{1}=1}^{n}|A_{m_{1} }|-\sum _{1\leqslant m_{1}<m_{2}\leqslant n}|A_{m_{1} }\cap A_{m_{2} }|+\cdots +(-1)^{p-1}\sum _{1\leqslant m_{1}<\cdots <m_{p}\leqslant n}|A_{m_{1} }\cap \cdots \cap A_{m_{p} }|+\cdots$$}@} Each value $A_{m_{1} }\cap \cdots \cap A_{m_{p} }$ represents {@{the set of shuffles having at least _p_ values _m_<sub>1</sub>, ..., _m<sub>p</sub>_ in the correct position}@}. Note that the number of shuffles with at least _p_ values correct only {@{depends on _p_, not on the particular values of $m$}@}. For example, {@{the number of shuffles having the 1<sup>st</sup>, 3<sup>rd</sup>, and 17<sup>th</sup> cards in the correct position is the same as the number of shuffles having the 2<sup>nd</sup>, 5<sup>th</sup>, and 13<sup>th</sup> cards in the correct positions}@}. It only matters that {@{of the _n_ cards, 3 were chosen to be in the correct position}@}. Thus there are {@{${n \choose p}$ equal terms in the _p<sup>th</sup>_ summation}@} (see [combination](combination.md)). {@{$$W={n \choose 1}|A_{1}|-{n \choose 2}|A_{1}\cap A_{2}|+\cdots +(-1)^{p-1}{n \choose p}|A_{1}\cap \cdots \cap A_{p}|+\cdots$$}@} $|A_{1}\cap \cdots \cap A_{p}|$ is {@{the number of orderings having _p_ elements in the correct position}@}, which is {@{equal to the number of ways of ordering the remaining _n_ − _p_ elements, or (_n_ − _p_)!}@}. Thus we finally get: {@{$${\begin{aligned}W&={n \choose 1}(n-1)!-{n \choose 2}(n-2)!+\cdots +(-1)^{p-1}{n \choose p}(n-p)!+\cdots \\&=\sum _{p=1}^{n}(-1)^{p-1}{n \choose p}(n-p)!\\&=\sum _{p=1}^{n}(-1)^{p-1}{\frac {n!}{p!(n-p)!} }(n-p)!\\&=\sum _{p=1}^{n}(-1)^{p-1}{\frac {n!}{p!} }\end{aligned} }$$}@} {@{A permutation where _no_ card is in the correct position}@} is {@{called a [derangement](derangement.md)}@}. Taking {@{_n_! to be the total number of permutations}@}, {@{the probability _Q_ that a random shuffle produces a derangement}@} is given by {@{$$Q=1-{\frac {W}{n!} }=\sum _{p=0}^{n}{\frac {(-1)^{p} }{p!} },$$}@} {@{a truncation to _n_ + 1 terms of the [Taylor expansion](taylor%20series.md) of _e_<sup>−1</sup>}@}. Thus {@{the probability of guessing an order for a shuffled deck of cards and being incorrect about every card}@} is {@{approximately _e_<sup>−1</sup> or 37%}@}. <!--SR:!2025-12-22,340,351!2025-12-17,336,351!2025-11-17,311,340!2025-11-18,312,340!2026-01-04,353,351!2025-12-31,349,351!2025-12-19,338,351!2025-11-22,316,340!2027-04-19,688,331!2027-02-28,655,320!2028-01-20,915,330!2025-12-17,336,340!2026-08-09,445,290!2025-12-24,343,351!2025-11-21,315,340!2025-11-13,307,330!2025-12-26,344,351!2028-01-01,857,311!2026-01-03,352,351!2028-01-08,901,330!2026-01-05,354,351-->

## a special case

The situation that appears in the derangement example above {@{occurs often enough to merit special attention}@}.<sup>[\[7\]](#^ref-7)</sup> Namely, when {@{the size of the intersection sets appearing in the formulas for the principle of inclusion–exclusion depend only on the number of sets in the intersections and not on which sets appear}@}. More formally, if {@{the intersection $$A_{J}:=\bigcap _{j\in J}A_{j}$$ has the same cardinality}@}, say {@{_α<sub>k</sub>_ = |_A<sub>J</sub>_|, for every _k_-element subset _J_ of {1, ..., _n_}<!-- flashcard separator -->}@}, then {@{$$\left|\bigcup _{i=1}^{n}A_{i}\right|=\sum _{k=1}^{n}(-1)^{k-1}{\binom {n}{k} }\alpha _{k}.$$}@} Or, in {@{the complementary form}@}, where {@{the universal set _S_ has cardinality _α_<sub>0</sub>}@}, {@{$$\left|S\smallsetminus \bigcup _{i=1}^{n}A_{i}\right|=\alpha _{0}-\sum _{k=1}^{n}(-1)^{k-1}{\binom {n}{k} }\alpha _{k} = \alpha_0 + \sum_{k = 1}^n (-1)^k \binom n k \alpha_k = \sum_{k = 0}^n (-1)^k \binom n k \alpha_k \,.$$}@} <!--SR:!2026-01-04,353,351!2025-12-27,346,351!2025-12-08,327,340!2025-12-23,341,351!2027-02-01,620,310!2025-11-22,316,340!2025-12-20,339,351!2025-12-31,349,351-->

## formula generalization

Given {@{a [family (repeats allowed) of subsets](family%20of%20sets.md) _A_<sub>1</sub>, _A_<sub>2</sub>, ..., _A_<sub>n</sub> of a universal set _S_}@}, the principle of inclusion–exclusion calculates {@{the number of elements of _S_ in none of these subsets}@}. A generalization of this concept would {@{calculate the number of elements of _S_ which appear in exactly some fixed _m_ of these sets}@}. <!--SR:!2025-11-22,316,340!2025-11-19,313,340!2025-12-28,347,351-->

Let {@{_N_ = [_n_] = {1,2,...,_n_} be the index set}@}. If we define {@{$A_{\emptyset }=S$}@}, then the principle of inclusion–exclusion can be written as, using the notation of the previous section; {@{the number of elements of _S_ contained in none of the _A_<sub>i</sub>}@} is: {@{$$\left\lvert S \smallsetminus \bigcup_{i = 1}^n A_i \right\rvert = \sum _{J\subseteq [n]}(-1)^{|J|}|A_{J}|.$$ (Example of interpreting $A_J$: $A_{\set{1, 4, 5} } = A_1 \cap A_4 \cap A_5$)}@} If {@{_I_ is a fixed subset of the index set _N_ (choose fixed _m_ subsets from a family of subsets)}@}, then {@{the number of elements which belong to _A_<sub>i</sub> for all _i_ in _I_ and for no other values is}@}:<sup>[\[8\]](#^ref-8)</sup> {@{$$\left\lvert A_I \smallsetminus \bigcup_{i \in N \smallsetminus I} A_i \right\rvert = \sum _{I\subseteq J}(-1)^{|J|-|I|}|A_{J}|.$$ (Note that $J \subseteq [n]$.)}@} Define the sets {@{$$B_{k}=A_{I\cup \{k\} }{\text{ for } }k\in N\smallsetminus I.$$}@} (annotation: This definition is {@{reframing $A_I$ as the new "universal set" $S$}@}.) We seek {@{the number of elements in none of the _B_<sub>k</sub>}@} which, by {@{the principle of inclusion–exclusion}@} (with $B_{\emptyset }=A_{I}$), is {@{$$\left\lvert B_\emptyset \smallsetminus \bigcup_{i \in N \smallsetminus I} B_i \right\rvert = \sum _{K\subseteq N\smallsetminus I}(-1)^{|K|}|B_{K}|.$$ (Example of interpreting $B_K$: $B_{\set{1, 4, 5} } = B_1 \cap B_4 \cap B_5$)}@} (annotation: This is {@{simply repeating the first equation in this section but with $B_\emptyset = A_I$ as the "universal set" $S$ instead}@}.) {@{The correspondence _K_ ↔ _J_ = _I_ ∪ _K_ between subsets of _N_ \ _I_ and subsets of _N_ containing _I_}@} is {@{a bijection}@} and if {@{_J_ and _K_ correspond under this map}@} then {@{_B_<sub>_K_</sub> = _A_<sub>_J_</sub>, showing that the result is valid}@}. <!--SR:!2025-12-08,327,340!2025-11-19,311,330!2025-12-23,342,351!2026-01-05,354,351!2025-10-31,294,330!2025-12-27,346,351!2027-01-06,598,310!2025-11-19,313,340!2028-02-04,927,330!2025-11-20,314,340!2025-11-05,299,330!2028-05-06,988,340!2028-03-26,948,330!2026-01-01,350,351!2025-09-25,253,331!2027-01-20,609,310!2025-12-24,342,351-->

## in probability

In [probability](probability.md), for {@{events _A_<sub>1</sub>, ..., _A_<sub>_n_</sub> in a [probability space](probability%20space.md) $(\Omega ,{\mathcal {F} },\mathbb {P} )$}@}, the inclusion–exclusion principle becomes for _n_ = 2 {@{$$\mathbb {P} (A_{1}\cup A_{2})=\mathbb {P} (A_{1})+\mathbb {P} (A_{2})-\mathbb {P} (A_{1}\cap A_{2}),$$}@} for _n_ = 3 {@{$$\mathbb {P} (A_{1}\cup A_{2}\cup A_{3})=\mathbb {P} (A_{1})+\mathbb {P} (A_{2})+\mathbb {P} (A_{3})-\mathbb {P} (A_{1}\cap A_{2})-\mathbb {P} (A_{1}\cap A_{3})-\mathbb {P} (A_{2}\cap A_{3})+\mathbb {P} (A_{1}\cap A_{2}\cap A_{3})$$}@} and in general {@{$$\mathbb {P} \left(\bigcup _{i=1}^{n}A_{i}\right)=\sum _{i=1}^{n}\mathbb {P} (A_{i})-\sum _{i<j}\mathbb {P} (A_{i}\cap A_{j})+\sum _{i<j<k}\mathbb {P} (A_{i}\cap A_{j}\cap A_{k})+\cdots +(-1)^{n-1}\sum _{i<...<n}\mathbb {P} \left(\bigcap _{i=1}^{n}A_{i}\right),$$}@} which can be written in closed form as {@{$$\mathbb {P} \left(\bigcup _{i=1}^{n}A_{i}\right)=\sum _{k=1}^{n}\left((-1)^{k-1}\sum _{I\subseteq \{1,\ldots ,n\} \atop |I|=k}\mathbb {P} (A_{I})\right),$$}@} where the last sum {@{runs over all subsets _I_ of the indices 1, ..., _n_ which contain exactly _k_ elements}@}, and $$A_{I}:=\bigcap _{i\in I}A_{i}$$ denotes {@{the intersection of all those _A<sub>i</sub>_ with index in _I_}@}. <!--SR:!2025-11-20,314,340!2026-01-05,354,351!2025-12-23,342,351!2025-09-30,257,331!2027-01-03,597,310!2027-02-24,651,320!2025-12-13,332,340-->

According to {@{the [Bonferroni inequalities](Boole's%20inequality.md#Bonferroni%20inequalities)}@}, {@{the sum of the first terms in the formula}@} is {@{alternately an upper bound and a lower bound for the [LHS](sides%20of%20an%20equation.md)}@}. This can be used in {@{cases where the full formula is too cumbersome}@}. <!--SR:!2027-06-15,734,331!2025-12-29,347,351!2027-04-22,686,320!2025-12-28,347,351-->

For {@{a general [measure space](measure%20space.md) (_S_,Σ,_μ_) and [measurable](measure%20(mathematics).md) subsets _A_<sub>1</sub>, ..., _A_<sub>_n_</sub> of finite measure}@}, the above identities {@{also hold when the probability measure $\mathbb {P}$ is replaced by the measure _μ_}@}. <!--SR:!2025-12-09,328,340!2025-09-26,254,331-->

### special case

If, in the probabilistic version of the inclusion–exclusion principle, {@{the probability of the intersection _A_<sub>_I_</sub> only depends on the cardinality of _I_}@}, meaning that for {@{every _k_ in {1, ..., _n_} there is an _a<sub>k</sub>_}@} such that {@{$$a_{k}=\mathbb {P} (A_{I}){\text{ for every } }I\subset \{1,\ldots ,n\}{\text{ with } }|I|=k,$$}@} then the above formula simplifies to {@{$$\mathbb {P} \left(\bigcup _{i=1}^{n}A_{i}\right)=\sum _{k=1}^{n}(-1)^{k-1}{\binom {n}{k} }a_{k}$$}@} due to {@{the combinatorial interpretation of the [binomial coefficient](binomial%20coefficient.md) ${\binom {n}{k} }$}@}. For example, if {@{the events $A_{i}$ are [independent and identically distributed](independent%20and%20identically%20distributed%20random%20variables.md)}@}, then {@{$\mathbb {P} (A_{i})=p$ for all _i_, and we have $a_{k}=p^{k}$}@}, in which case the expression above simplifies to {@{$$\mathbb {P} \left(\bigcup _{i=1}^{n}A_{i}\right)=1-(1-p)^{n}.$$}@} (This result can also be derived more simply by {@{considering the intersection of the complements of the events $A_{i}$}@}.) <!--SR:!2025-12-26,344,351!2025-12-30,349,351!2028-03-30,974,340!2026-07-12,431,290!2025-09-26,254,331!2025-12-27,345,351!2025-11-22,316,340!2025-12-29,347,351!2025-11-17,311,340-->

An analogous simplification is possible in the case of {@{a general measure space (_S_, Σ, _μ_) and measurable subsets _A_<sub>1</sub>, ..., _A_<sub>_n_</sub> of finite measure}@}. <!--SR:!2025-12-12,331,340-->

## other formulas

The principle is sometimes stated in the form<sup>[\[9\]](#^ref-9)</sup> that says that if {@{$$g(A)=\sum _{S\subseteq A}f(S)$$}@} then {@{$$f(A)=\sum _{S\subseteq A}(-1)^{|A|-|S|}g(S) \qquad \textbf{(2)}$$ <a id="math_2"></a>}@}. (annotation: How to understand this? Let {@{there be a universal set $S$ and their subsets}@}. Let each subset (including $S$) {@{has two numerical properties, which are given ("measured") by $f(X)$ and $g(X)$ for any subset $X$}@}. Then the above formula {@{relates the two properties of any subset together using the inclusion–exclusion principle}@}. In a way, this is {@{an abstraction and generalization of the more intuitive formulas above}@}.) <!--SR:!2025-12-20,339,351!2027-04-10,680,331!2025-11-20,312,330!2027-08-11,732,320!2028-04-16,965,330!2027-07-03,749,331-->

{@{The combinatorial and the probabilistic version of the inclusion–exclusion principle}@} are instances of (__[2](#math_2)__). <!--SR:!2028-01-24,917,330-->

> __Proof__
>
> Take {@{${\underline {m} }=\{1,2,\ldots ,m\}$, $f({\underline {m} })=0$}@} (annotation: $\underline m$ can be interpreted as {@{the index set of the family of all sets being considered}@}. Then, $f(\underline m)$ can be interpreted as {@{the size of the intersection of sets not indexed by $\underline m$, excluding any element in sets indexed by $\underline m$}@}. This is {@{$0$ intuitively because all sets being considered are indexed by $\underline m$}@}.), and {@{$$f(S)=\left|\bigcap _{i\in {\underline {m} }\smallsetminus S}A_{i}\smallsetminus \bigcup _{i\in S}A_{i}\right|{\text{ and } }f(S)=\mathbb {P} \left(\bigcap _{i\in {\underline {m} }\smallsetminus S}A_{i}\smallsetminus \bigcup _{i\in S}A_{i}\right)$$ respectively}@} for {@{all [sets](set%20(mathematics).md) $S$ with $S\subsetneq {\underline {m} }$}@}. (annotation: $f(S)$ can be interpreted as {@{the size of the intersection of sets not indexed by $S$, excluding any element in sets indexed by $S$}@}. Each element in the set being counted for its size to obtain $f(S)$ {@{belongs to all sets not indexed by $S$ and _only_ to sets not indexed by $S$}@}. Equivalently, each element {@{does not belong to the sets indexed by $S$ and _only_ does not belong to the sets indexed by $S$}@}. For example, if $\underline m = \set{1, 2}$ and $S = \set{1}$, then each element {@{belongs to $A_2$ and to $A_2$ only}@}. So {@{an element that does not belong to $A_2$}@} is excluded. An element {@{that belongs to $A_1$, no matter if it belongs to $A_2$}@}, is also excluded.) Then we obtain {@{$$g(A)=\left|\bigcap _{i\in {\underline {m} }\smallsetminus A}A_{i}\right|,\quad g({\underline {m} })=\left|\bigcup _{i\in {\underline {m} } }A_{i}\right|{\text{ and } }g(A)=\mathbb {P} \left(\bigcap _{i\in {\underline {m} }\smallsetminus A}A_{i}\right),~~g({\underline {m} })=\mathbb {P} \left(\bigcup _{i\in {\underline {m} } }A_{i}\right)$$ respectively}@} for {@{all sets $A$ with $A\subsetneq {\underline {m} }$}@}. This is because {@{[elements](element%20(mathematics).md) $a$ of $\cap _{i\in {\underline {m} }\smallsetminus A}A_{i}$ can be [contained](element%20(mathematics).md#notation) in other $A_{i}$ ($A_{i}$ with $i\in A$) as well}@}, and {@{the $\cap \smallsetminus \cup$-formula runs exactly through all possible extensions of the sets $\{A_{i}\mid i\in {\underline {m} }\smallsetminus A\}$ with other $A_{i}$}@}, counting $a$ only for {@{the set that matches the membership behavior of $a$}@}, if {@{$S$ runs through all [subsets](subset.md) of $A$ (as in the definition of $g(A)$)}@}. (annotation: Consider this from {@{the perspective of an element}@}. Each element can {@{belong to 0 or more sets}@}. So we can assign each element a _membership_ property that is {@{the index set of the sets it belongs to}@}. Then, $f(S)$, which uses the $\cap \smallsetminus \cup$ formula, is {@{counting the number of elements with a specific membership property value}@}. This cannot {@{double count because an element cannot have multiple values for its membership property}@}. So $g(S)$, which sums $f(S)$ over all possible subsets of $S$, properly yields {@{the size of elements that at least belong to all sets not indexed by $S$}@}. When $S = \underline m$, then it is {@{the size of elements that at least belong to all sets not indexed by $\underline m$, which are no sets}@}, so $g(\underline m)$ is the union of all considered sets.)
>
> Since {@{$f({\underline {m} })=0$}@}, we obtain from (__[2](#math_2)__) with {@{$A={\underline {m} }$}@} that {@{$$\begin{aligned} f(\underline m) & = 0 \\ \sum_{\varnothing \subseteq S \subseteq \underline m} (-1)^{\lvert \underline m \rvert - \lvert S \rvert} g(S) & = 0 \\ \sum_{\varnothing \subseteq S \subsetneq \underline m} (-1)^{\lvert \underline m \rvert - \lvert S \rvert} g(\underline S) & = -g(\underline m) \\ \sum_{\varnothing \subseteq S \subsetneq \underline m} (-1)^{\lvert \underline m \rvert - \lvert S \rvert - 1} g(\underline S) & = g(\underline m) \end{aligned}$$}@} (annotation: {@{We are trying to extract $g(\underline m)$, because it equals the left hand side of the inclusion–exclusion principle.}@}), and finally {@{$$\sum _{ {\underline {m} }\supseteq T\supsetneq \varnothing }(-1)^{|T|-1}g({\underline {m} }\smallsetminus T)=\sum _{\varnothing \subseteq S\subsetneq {\underline {m} } }(-1)^{m-|S|-1}g(S)=g({\underline {m} })$$}@} (annotation: The leftmost expression can be obtained by {@{replacing the index set $S$ by its complement index set $T := \underline m \smallsetminus S$ (i.e. $S = \underline m \smallsetminus T$) under the summation sign (remember to change the summation bounds)}@}. Then {@{interpret $g(\underline m \smallsetminus T)$ as the size of elements that at least belong to all sets not indexed by $\underline m \smallsetminus T$, which is simply the size of elements that at least belong to all sets indexed by $T$ (intersection of $T$)}@}. This finally gives an interpretation that is {@{equivalent to one on the right hand side of the inclusion–exclusion principle}@}.) and by {@{interchanging sides}@}, {@{the combinatorial and the probabilistic version of the inclusion–exclusion principle}@} follow. <!--SR:!2027-12-25,892,330!2025-11-03,297,330!2027-06-02,726,331!2025-11-02,296,330!2026-03-11,343,291!2028-07-07,1058,351!2028-05-03,986,340!2025-12-28,346,351!2025-12-19,338,351!2025-12-09,328,340!2025-12-23,342,351!2025-11-21,315,340!2026-11-03,516,311!2025-12-27,345,351!2026-01-04,353,351!2026-11-23,490,270!2025-12-17,336,351!2025-09-24,252,331!2025-12-28,346,351!2025-12-27,346,351!2025-12-25,344,351!2025-12-15,334,340!2025-11-20,314,340!2026-10-08,496,311!2025-11-22,316,340!2025-11-01,295,330!2025-09-30,257,331!2025-09-30,257,331!2028-04-07,981,340!2025-09-24,252,331!2025-12-23,341,351!2026-02-04,314,280!2028-04-01,980,351!2025-12-18,337,351!2026-01-05,354,351-->

If one sees {@{a number $n$ as a set of its prime factors}@}, then (__[2](#math_2)__) is {@{a generalization of [Möbius inversion formula](Möbius%20inversion%20formula.md) for [square-free](square-free%20integer.md) [natural numbers](natural%20number.md)}@}. Therefore, (__[2](#math_2)__) is seen as {@{the Möbius inversion formula for the [incidence algebra](incidence%20algebra.md) of the [partially ordered set](partially%20ordered%20set.md) of all subsets of _A_}@}. <!--SR:!2025-11-07,301,330!2026-11-22,529,311!2026-04-01,322,260-->

For {@{a generalization of the full version of Möbius inversion formula}@}, (__[2](#math_2)__) must be {@{generalized to [multisets](multiset.md)}@}. For multisets instead of sets, (__[2](#math_2)__) becomes {@{$$f(A)=\sum _{S\subseteq A}\mu (A-S)g(S) \qquad \textbf{(3)}$$ <a id="math_3"></a>}@} where {@{$A-S$ is the multiset for which $(A-S)\uplus S=A$ (i.e. add the multiplicity of elements)}@}, and <!--SR:!2025-12-16,335,340!2026-01-03,352,351!2026-01-04,353,351!2025-09-17,245,320-->

- _μ_(_S_) = 1 ::@:: if _S_ is a set (i.e. a multiset without double elements) of [even](parity%20(mathematics).md) [cardinality](cardinality.md). <!--SR:!2028-03-27,971,340!2025-12-13,332,340-->
- _μ_(_S_) = −1 ::@:: if _S_ is a set (i.e. a multiset without double elements) of odd cardinality. <!--SR:!2025-12-11,330,340!2025-12-10,329,340-->
- _μ_(_S_) = 0 ::@:: if _S_ is a proper multiset (i.e. _S_ has double elements). <!--SR:!2025-12-18,337,351!2025-12-30,349,351-->

Notice that $\mu (A-S)$ is {@{just the $(-1)^{|A|-|S|}$ of (__[2](#math_2)__) in case $A-S$ is a set}@}. <!--SR:!2025-12-24,343,351-->

> __Proof of ([3](#math_3))__
>
> {@{Substitute $$g(S)=\sum _{T\subseteq S}f(T)$$ on the right hand side of (__[3](#math_3)__) (the domain of $f(T)$ is extended to include multisets)}@}. Notice that {@{$f(A)$ appears once on both sides of (__[3](#math_3)__)}@}. So we must show that {@{for all $T$ with $T\subsetneq A$, the terms $f(T)$ cancel out on the right hand side of (__[3](#math_3)__)}@}. For that purpose, {@{take a fixed $T$ such that $T\subsetneq A$ and take an arbitrary fixed $a\in A$ such that $a\notin T$}@}. (annotation: This is using {@{the [method of distinguished element](method%20of%20distinguished%20element.md)}@}.)
>
> Notice that {@{$A-S$ must be a set for each [positive](sign%20(mathematics).md#terminology%20for%20signs) or [negative](negative%20number.md) appearance of $f(T)$ on the right hand side of (__[3](#math_3)__) (if $A - S$ is a proper multiset, then $\mu(A - S) = 0$)}@} that is obtained by way of the multiset $S$ such that $T\subseteq S\subseteq A$. Now {@{each appearance of $f(T)$ on the right hand side of (__[3](#math_3)__)}@} that is {@{obtained by way of $S$ such that $A-S$ is a set that contains $a$ cancels out with the one that is obtained by way of the corresponding $S$ such that $A-S$ is a set that does not contain $a$}@}. (annotation: Assume there is a $f(T)$ term for any $T$ that satisfies $T \subseteq S \subseteq A$ and $T \subsetneq A$. Since we only care about $T \subsetneq A$, so {@{we can fix an element $a \in A$ that satisfies $a \notin T$ ($T$ is fixed so this is okay)}@}. Since $A - S$ must be a set for $f(T)$ to contribute, so {@{we only care about where $A - S$ is a set}@}. Consider {@{all possibilities for $A - S$ where $a \notin A - S$ (i.e. $a \in S$)}@}. For each possibility, we can {@{always add an $a$ to $A - S$ (i.e. remove $a$ from $S$ such that $a \notin S$) to get another valid possibility for $A - S$}@}. This {@{does not modify the possibilities for $T \subseteq S$ even if $S$ is modified because $a \notin T$}@}. Also, the operation above is always allowed because {@{it still satisfies $T \subseteq S \subseteq A$ and $T \subsetneq A$}@}. Further, this also {@{gives all possibilities (completeness) for $A - S$ because a set either has $a$ or does not have $a$}@}. Now consider $\mu(A - S)$. This term {@{must always be opposite between the sets with $a$ and without $a$}@}. Since the number of sets with $a$ and without $a$ are the same, {@{the number of positive and negative $f(T)$ terms are the same and they cancel out}@}.) This gives the desired result. <!--SR:!2026-08-08,444,290!2028-07-15,1068,351!2027-04-13,679,320!2027-08-13,720,320!2025-12-12,331,340!2026-07-08,431,290!2025-12-26,344,351!2026-10-01,487,300!2025-12-27,346,351!2025-12-16,335,340!2025-12-30,349,351!2026-01-02,351,351!2028-05-07,1004,340!2025-09-26,254,331!2025-11-18,310,330!2025-12-31,349,351!2025-12-27,345,351-->

## applications

The inclusion–exclusion principle is widely used and only a few of its applications can be mentioned here.

<!-- markdownlint-disable-next-line MD024 -->
### counting derangements

- see: [derangement](derangement.md)

<!-- markdownlint-capture -->
<!-- markdownlint-disable MD059 -->

A well-known application of the inclusion–exclusion principle is to {@{the combinatorial problem of counting all [derangements](derangement.md) of a finite set}@}. A _derangement_ of a set _A_ is {@{a [bijection](bijection.md) from _A_ into itself that has no fixed points}@}. Via the inclusion–exclusion principle one can show that if {@{the cardinality of _A_ is _n_}@}, then {@{the number of derangements is [_n_! / _e_] where [_x_] denotes the [nearest integer](rounding.md#rounding%20to%20the%20nearest%20integer) to _x_}@}; a detailed proof is available [here](random%20permutation%20statistics.md#number%20of%20permutations%20that%20are%20derangements) and also see [the examples section](#examples) above. <!--SR:!2025-12-26,345,351!2025-12-28,346,351!2025-12-14,333,340!2028-01-08,904,330-->

<!-- markdownlint-restore -->

The first occurrence of the problem of counting the number of derangements is in an early book on games of chance: _Essai d'analyse sur les jeux de hazard_ by P. R. de Montmort (1678 – 1719) and was known as either "Montmort's problem" or by the name he gave it, "_problème des rencontres_."<sup>[\[10\]](#^ref-10)</sup> The problem is also known as the _hatcheck problem._

The number of derangements is also known as {@{the [subfactorial](derangement.md) of _n_, written !_n_}@}. It follows that if {@{all bijections are assigned the same probability}@} then {@{the probability that a random bijection is a derangement quickly approaches 1/_e_ as _n_ grows}@}. <!--SR:!2025-12-15,334,340!2028-03-21,944,330!2026-01-02,351,351-->

### counting intersections

The principle of inclusion–exclusion, combined with {@{[De Morgan's law](De%20Morgan's%20laws.md)}@}, can be used to {@{count the cardinality of the intersection of sets as well}@}. Let ${\overline {A_{k} } }$ represent {@{the complement of _A<sub>k</sub>_ with respect to some universal set _A_ such that $A_{k}\subseteq A$ for each _k_}@}. Then we have {@{$$\bigcap _{i=1}^{n}A_{i}={\overline {\bigcup _{i=1}^{n}{\overline {A_{i} } } } }$$}@} thereby {@{turning the problem of finding an intersection into the problem of finding a union}@}. <!--SR:!2025-12-29,348,351!2028-06-25,1051,351!2028-08-18,1095,351!2028-01-25,918,330!2025-12-29,348,351-->

### graph coloring

The inclusion exclusion principle forms {@{the basis of algorithms for a number of NP-hard graph partitioning problems, such as graph coloring}@}.<sup>[\[11\]](#^ref-11)</sup> <!--SR:!2027-03-06,660,320-->

A well known application of the principle is {@{the construction of the [chromatic polynomial](chromatic%20polynomial.md) of a graph}@}.<sup>[\[12\]](#^ref-12)</sup> <!--SR:!2026-01-03,352,351-->

### bipartite graph perfect matchings

{@{The number of [perfect matchings](perfect%20matching.md) of a [bipartite graph](bipartite%20graph.md)}@} can be calculated using the principle.<sup>[\[13\]](#^ref-13)</sup> <!--SR:!2027-09-17,767,351-->

### number of onto functions

Given {@{finite sets _A_ and _B_}@}, how many {@{[surjective functions](surjective%20function.md) (onto functions) are there from _A_ to _B_}@}? [Without any loss of generality](without%20loss%20of%20generality.md) we may {@{take _A_ = {1, ..., _k_} and _B_ = {1, ..., _n_}<!-- flashcard separator -->}@}, since {@{only the cardinalities of the sets matter}@}. By using {@{_S_ as the set of all [functions](function%20(mathematics).md) from _A_ to _B_}@}, and defining, {@{for each _i_ in _B_, the property _P<sub>i</sub>_ as "the function misses the element _i_ in _B_" (_i_ is not in the [image](image%20(mathematics).md) of the function)}@}, the principle of inclusion–exclusion gives {@{the number of onto functions between _A_ and _B_}@} as:<sup>[\[14\]](#^ref-14)</sup> {@{$$\sum _{j=0}^{n}{\binom {n}{j} }(-1)^{j}(n-j)^{k}.$$}@} (annotation: Direct enumeration is difficult because {@{each element of the co-domain may be mapped to by one or more elements in the domain}@}. {@{$(n - j)^k$}@} counts {@{the number of ways to assign $k$ inputs to $(n - j)$ outputs}@}.) <!--SR:!2025-11-16,310,340!2025-12-21,340,351!2028-01-04,901,330!2025-11-17,311,340!2026-12-11,588,310!2026-01-01,350,351!2025-12-07,326,340!2027-08-05,713,320!2025-12-25,344,351!2026-01-03,352,351!2025-11-15,309,340-->

### permutations with forbidden positions

{@{A [permutation](permutation.md) of the set _S_ = {1, ..., _n_} where each element of _S_ is restricted to not being in certain positions (here the permutation is considered as an ordering of the elements of _S_)}@} is {@{called a _permutation with forbidden positions_}@}. For example, with _S_ = {1,2,3,4}, the permutations with the restriction that the element 1 can not be in positions 1 or 3, and the element 2 can not be in position 4 are: 2134, 2143, 3124, 4123, 2341, 2431, 3241, 3421, 4231 and 4321. By letting {@{_A<sub>i</sub>_ be the set of positions that the element _i_ is not allowed to be in}@}, and the property _P_<sub>_i_</sub> to be {@{the property that a permutation puts element _i_ into a position in _A<sub>i</sub>_}@}, the principle of inclusion–exclusion can be used to {@{count the number of permutations which satisfy all the restrictions}@}.<sup>[\[15\]](#^ref-15)</sup> <!--SR:!2025-12-20,339,351!2025-11-18,312,340!2026-01-05,354,351!2026-01-03,352,351!2025-11-21,315,340-->

In the given example, there are {@{12 = 2(3!) permutations with property _P_<sub>1</sub>, 6 = 3! permutations with property _P_<sub>2</sub>}@} and no permutations have properties _P_<sub>3</sub> or _P_<sub>4</sub> as {@{there are no restrictions for these two elements}@}. The number of permutations satisfying the restrictions is thus: <p> {@{4! − (12 + 6 + 0 + 0) + (4) = 24 − 18 + 4 = 10}@}. <!--SR:!2025-11-15,309,340!2025-09-29,256,331!2026-11-24,531,311-->

The final 4 in this computation is {@{the number of permutations having both properties _P_<sub>1</sub> and _P_<sub>2</sub>}@}. There are {@{no other non-zero contributions to the formula}@}. <!--SR:!2026-01-01,350,351!2025-12-27,345,351-->

### Stirling numbers of the second kind

- see: [Stirling numbers of the second kind](Stirling%20numbers%20of%20the%20second%20kind.md)

{@{The [Stirling numbers of the second kind](Stirling%20numbers%20of%20the%20second%20kind.md), _S_(_n_,_k_)}@} count {@{the number of [partitions](partition%20of%20a%20set.md) of a set of _n_ elements into _k_ non-empty subsets (indistinguishable _boxes_)}@}. An explicit formula for them can be obtained by {@{applying the principle of inclusion–exclusion to a very closely related problem}@}, namely, {@{counting the number of partitions of an _n_-set into _k_ non-empty but distinguishable boxes ([ordered](partially%20ordered%20set.md) non-empty subsets)}@}. Using the universal set {@{consisting of all partitions of the _n_-set into _k_ (possibly empty) distinguishable boxes, _A_<sub>1</sub>, _A_<sub>2</sub>, ..., _A<sub>k</sub>_}@}, and {@{the properties _P<sub>i</sub>_ meaning that the partition has box _A<sub>i</sub>_ empty}@}, the principle of inclusion–exclusion gives an answer for the related result. (annotation: {@{The underlying structure of this problem is equivalent to [counting the number of onto functions](#counting%20the%20number%20of%20onto%20functions) above.}@}) {@{Dividing by _k_! to remove the artificial ordering}@} gives {@{the Stirling number of the second kind}@}:<sup>[\[16\]](#^ref-16)</sup> {@{$$S(n,k)={\frac {1}{k!} }\sum _{t=0}^{k}(-1)^{t}{\binom {k}{t} }(k-t)^{n}.$$}@} <!--SR:!2025-12-30,348,351!2027-12-30,897,330!2025-11-18,312,340!2025-12-25,344,351!2027-04-11,678,320!2025-11-19,313,340!2025-12-06,325,340!2025-11-19,313,340!2025-12-06,325,340!2026-11-27,533,311-->

### rook polynomials

- see: [rook polynomial](rook%20polynomial.md)

A rook polynomial is {@{the [generating function](generating%20function.md)}@} of {@{the number of ways to place non-attacking [rooks](rook%20(chess).md) on a _board B_ that looks like a subset of the squares of a [checkerboard](checkerboard.md)}@}; that is, {@{no two rooks may be in the same row or column}@}. The board _B_ is {@{any subset of the squares of a rectangular board with _n_ rows and _m_ columns}@}; we think of it as {@{the squares in which one is allowed to put a rook}@}. {@{The [coefficient](coefficient.md), _r<sub>k</sub>_(_B_) of _x<sup>k</sup>_}@} in the rook polynomial _R<sub>B</sub>_(_x_) is {@{the number of ways _k_ rooks, none of which attacks another, can be arranged in the squares of _B_}@}. For any board _B_, there is {@{a complementary board $B'$ consisting of the squares of the rectangular board that are not in _B_}@}. This complementary board {@{also has a rook polynomial $R_{B'}(x)$ with coefficients $r_{k}(B')$}@}. <!--SR:!2025-12-21,340,351!2025-12-19,338,351!2025-11-21,315,340!2026-01-02,351,351!2025-11-19,313,340!2025-10-01,258,331!2027-01-13,605,310!2025-12-18,337,351!2025-12-07,326,340-->

It is sometimes convenient to be able to {@{calculate the highest coefficient of a rook polynomial in terms of the coefficients of the rook polynomial of the complementary board}@}. (A scenario is {@{where the complementary board only has a few squares, so its rook polynomial can be manually computed}@}.) Without loss of generality we can {@{assume that _n_ ≤ _m_}@}, so this coefficient is {@{_r<sub>n</sub>_(_B_) (because you can put at most _n_ rooks in a _n_ × _m_)}@}. The number of ways to {@{place _n_ non-attacking rooks on the complete _n_ × _m_ "checkerboard" (without regard as to whether the rooks are placed in the squares of the board _B_)}@} is given by {@{the [falling factorial](falling%20and%20rising%20factorials.md): $$(m)_{n}=m(m-1)(m-2)\cdots (m-n+1).$$}@} <!--SR:!2026-11-28,532,311!2025-12-16,335,351!2025-11-20,314,340!2025-12-12,331,340!2028-01-21,916,330!2025-11-16,311,360-->

Letting {@{_P_<sub>i</sub> be the property that an assignment of _n_ non-attacking rooks on the complete board has a rook in column _i_ which is not in a square of the board _B_}@}, then by the principle of inclusion–exclusion we have:<sup>[\[17\]](#^ref-17)</sup> {@{$$r_{n}(B)=\sum _{t=0}^{n}(-1)^{t}(m-t)_{n-t}r_{t}(B').$$}@} (annotation: {@{$(m - t)_{n - t}$}@} considers {@{putting $n - t$ rooks onto a $n \times (m - t)$ board without considering if the rooks are placed in the squares of the board _B_}@}. {@{The missing $t$ columns}@} are {@{accounted for by $r_t(B')$}@}, which considers {@{putting $t$ rooks onto a $n \times t$ board, all consisting of columns such that a certain combination of $P_i$ are satisfied}@}.) <!--SR:!2025-09-29,256,331!2026-03-16,346,291!2025-11-20,314,340!2025-10-01,258,331!2027-07-20,717,320!2025-12-15,334,340!2026-03-09,342,291-->

### Euler's phi function

- see: [Euler's totient function](Euler's%20totient%20function.md)

{@{Euler's totient or phi function, _φ_(_n_)}@} is {@{an [arithmetic function](arithmetic%20function.md)}@} that {@{counts the number of positive integers less than or equal to _n_ that are [relatively prime](coprime%20integers.md) to _n_}@}. That is, if {@{_n_ is a [positive integer](natural%20number.md)}@}, then {@{φ(_n_) is the number of integers _k_ in the range 1 ≤ _k_ ≤ _n_ which have no common factor with _n_ other than 1}@}. The principle of inclusion–exclusion is {@{used to obtain a formula for φ(_n_)}@}. Let {@{_S_ be the set {1, ..., _n_}<!-- flashcard separator -->}@} and define {@{the property _P<sub>i</sub>_ to be that a number in _S_ is divisible by the prime number _p<sub>i</sub>_}@}, for {@{1 ≤ _i_ ≤ _r_, where the [prime factorization](integer%20factorization.md) of $$n=p_{1}^{a_{1} }p_{2}^{a_{2} }\cdots p_{r}^{a_{r} }.$$}@} Then,<sup>[\[18\]](#^ref-18)</sup> {@{$$\varphi (n)=n-\sum _{i=1}^{r}{\frac {n}{p_{i} } }+\sum _{1\leqslant i<j\leqslant r}{\frac {n}{p_{i}p_{j} } }-\cdots =n\prod _{i=1}^{r}\left(1-{\frac {1}{p_{i} } }\right).$$}@} (annotation: This should be trivial... The rightmost expression {@{generates all the terms in the middle expression}@}.) <!--SR:!2027-04-17,682,320!2025-11-17,311,340!2025-11-21,315,340!2025-12-28,347,351!2027-03-28,667,320!2025-12-24,343,351!2025-11-06,300,330!2025-12-22,341,351!2025-11-15,309,340!2027-05-17,722,331!2025-11-15,309,340-->

### Dirichlet hyperbola method

- see: [Dirichlet hyperbola method](Dirichlet%20hyperbola%20method.md)

{@{The Dirichlet hyperbola method}@} {@{re-expresses a sum of a [multiplicative function](multiplicative%20function.md) $f(n)$ ($n \in \mathbb N_{\ge 1}$, $f(1) = 1$, $f(a) f(b) = f(ab)$ whenever $a$ and $b$ are co-prime)}@} by {@{selecting a suitable [Dirichlet convolution](Dirichlet%20convolution.md) $f=g\ast h$}@}, recognizing that {@{the sum $$F(n)=\sum _{k=1}^{n}f(k)=\sum _{k=1}^{n}\sum _{xy=k}^{}g(x)h(y)$$}@} can be {@{recast as a sum over the [lattice points](lattice%20(group).md) in a region bounded by $x\geq 1$, $y\geq 1$, and $xy\leq n$}@}, {@{splitting this region into two overlapping subregions (by choosing $a$ and $b$ such that $ab = n$, and cutting the region by $x = a$ and $y = b$)}@}, and finally {@{using the inclusion–exclusion principle}@} to conclude that {@{$$F(n)=\sum _{k=1}^{n}f(k)=\sum _{k=1}^{n}\sum _{xy=k}^{}g(x)h(y)=\sum _{x=1}^{a}\sum _{y=1}^{n/x}g(x)h(y)+\sum _{y=1}^{b}\sum _{x=1}^{n/y}g(x)h(y)-\sum _{x=1}^{a}\sum _{y=1}^{b}g(x)h(y).$$}@} <!--SR:!2025-12-14,333,340!2026-01-02,351,351!2025-12-20,339,351!2025-09-24,252,331!2026-01-03,352,351!2025-12-29,348,351!2025-12-25,343,351!2026-03-22,373,290-->

## diluted inclusion–exclusion principle

- see: [Bonferroni inequalities](Boole's%20inequality.md#Bonferroni%20inequalities)

In {@{many cases where the principle could give an exact formula}@} (in particular, {@{counting [prime numbers](prime%20number.md) using the [sieve of Eratosthenes](sieve%20of%20Eratosthenes.md)}@}), the formula arising {@{does not offer useful content because the number of terms in it is excessive}@}. If {@{each term individually can be estimated accurately}@}, {@{the accumulation of errors}@} may imply that {@{the inclusion–exclusion formula is not directly applicable}@}. In [number theory](number%20theory.md), this difficulty was addressed by [Viggo Brun](Viggo%20Brun.md). After a slow start, {@{his ideas were taken up by others, and a large variety of [sieve methods](sieve%20theory.md)}@} developed. These for example may {@{try to find upper bounds for the "sieved" sets, rather than an exact formula}@}. <!--SR:!2026-01-02,351,351!2025-12-22,340,351!2028-04-13,986,340!2028-08-23,1099,351!2025-12-31,349,351!2028-04-24,995,340!2025-11-14,306,330!2025-09-29,256,331-->

Let {@{_A_<sub>1</sub>, ..., _A_<sub>_n_</sub> be arbitrary sets and _p_<sub>1</sub>, ..., _p_<sub>_n_</sub> real numbers in the closed unit interval [0, 1]}@}. Then, for {@{every even number _k_ in {0, ..., _n_}<!-- flashcard separator -->}@}, {@{the [indicator functions](indicator%20function.md)}@} satisfy {@{the inequality:<sup>[\[19\]](#^ref-19)</sup> $$1_{A_{1}\cup \cdots \cup A_{n} }\geq \sum _{j=1}^{k}(-1)^{j-1}\sum _{1\leq i_{1}<\cdots <i_{j}\leq n}p_{i_{1} }\dots p_{i_{j} }\,1_{A_{i_{1} }\cap \cdots \cap A_{i_{j} } }.$$}@} \(annotation: This is {@{very similar to the inclusion–exclusion principle}@}. {@{The indicator functions}@} correspond to {@{the sizes of sets as above}@}. The only important difference is that {@{the intersection term is multiplied by $p_{i_1} \cdots p_{i_j}$}@}. Clearly, the above inequality {@{holds when all $p_{i_k} = 1$}@}. Now consider {@{$p_{i_k} = 1$ for some $k$}@}. Consider {@{the terms containing $p_{i_k}$}@}. We see that {@{they sum up to the size of $A_{i_j}$}@}. Now {@{decrease $p_{i_k}$ such that $p_{i_k} < 1$}@}. We see {@{this is equivalent to multiplying the size of $A_{i_j}$ by $p_{i_k}$ independently of other sets \(like independence in probability theory\)}@}. Obviously, this {@{cannot enlarge beyond the union of all sets represented by the left hand side}@}, so {@{the right hand side remains smaller than the left hand side}@}. Now {@{by induction}@}, {@{repeat this step for all other $k$ with $p_{i_k} < 1$}@}, using {@{the shrunk union of all sets as the new left hand side}@}. By {@{transitivity of inequality}@}, {@{the above inequality holds}@}.\) <!--SR:!2025-12-25,343,351!2027-12-26,893,330!2025-12-26,345,351!2027-04-21,691,331!2026-01-01,350,351!2025-11-12,306,330!2025-11-08,302,330!2026-01-05,354,351!2025-12-24,125,397!2025-12-27,127,397!2026-01-07,137,397!2025-12-21,122,397!2025-12-22,123,397!2026-01-06,136,397!2026-01-07,137,397!2025-12-26,126,397!2025-12-28,128,397!2025-12-25,126,397!2025-12-29,129,397!2026-01-06,136,397!2025-12-23,124,397-->

## proof of main statement

Choose {@{an element contained in the union of all sets}@} and let {@{$A_{1},A_{2},\dots ,A_{t}$ be the individual sets containing it}@}. (Note that {@{_t_ > 0}@}.) Since {@{the element is counted precisely once by the left-hand side of equation (__[1](#math_1)__)}@}, we need to show that {@{it is counted precisely once by the right-hand side}@}. On the right-hand side, {@{the only non-zero contributions occur}@} when {@{all the subsets in a particular term contain the chosen element}@}, that is, {@{all the subsets are selected from $A_{1},A_{2},\dots ,A_{t}$}@}. The contribution is {@{one for each of these sets (plus or minus depending on the term)}@} and therefore is {@{just the (signed) number of these subsets used in the term}@}. We then have: {@{$${\begin{aligned} & \phantom = |\{A_{i}\mid 1\leqslant i\leqslant t\}|-|\{A_{i}\cap A_{j}\mid 1\leqslant i<j\leqslant t\}|+\cdots +(-1)^{t+1}|\{A_{1}\cap A_{2}\cap \cdots \cap A_{t}\}| \\ & ={\binom {t}{1} }-{\binom {t}{2} }+\cdots +(-1)^{t+1}{\binom {t}{t} }.\end{aligned} }$$}@} By {@{the [binomial theorem](binomial%20theorem.md)}@}, {@{$$0=(1-1)^{t}={\binom {t}{0} }-{\binom {t}{1} }+{\binom {t}{2} }-\cdots +(-1)^{t}{\binom {t}{t} }.$$}@} Using {@{the fact that ${\binom {t}{0} }=1$ and rearranging terms}@}, we have {@{$$1={\binom {t}{1} }-{\binom {t}{2} }+\cdots +(-1)^{t+1}{\binom {t}{t} },$$}@} and so, {@{the chosen element is counted only once by the right-hand side of equation (__[1](#math_1)__)}@}. <!--SR:!2025-11-15,309,340!2025-12-12,331,340!2025-12-10,329,340!2026-01-02,351,351!2025-12-31,349,351!2025-11-16,310,340!2026-11-04,562,310!2025-11-20,314,340!2025-12-22,340,351!2025-11-18,312,340!2025-11-16,310,340!2026-01-05,354,351!2025-12-11,330,340!2025-12-21,340,351!2028-03-28,972,340!2025-12-19,338,351-->

### algebraic proof

An algebraic proof can be obtained using {@{[indicator functions](indicator%20function.md) (also known as characteristic functions)}@}. {@{The indicator function of a subset _S_ of a set _X_}@} is {@{the function $${\begin{aligned}&\mathbf {1} _{S}:X\to \{0,1\}\\&\mathbf {1} _{S}(x)={\begin{cases}1&x\in S\\0&x\notin S \,. \end{cases} }\end{aligned} }$$}@} If {@{$A$ and $B$ are two subsets of $X$}@}, then {@{$$\mathbf {1} _{A}\cdot \mathbf {1} _{B}=\mathbf {1} _{A\cap B}.$$}@} <!--SR:!2025-12-30,348,351!2025-12-22,341,351!2026-01-04,353,351!2025-12-30,348,351!2025-12-25,344,351-->

Let {@{_A_ denote the union $\bigcup _{i=1}^{n}A_{i}$ of the sets _A_<sub>1</sub>, ..., _A<sub>n</sub>_}@}. To {@{prove the inclusion–exclusion principle in general}@}, we first {@{verify the identity $$\mathbf {1} _{A}=\sum _{k=1}^{n}(-1)^{k-1}\sum _{I\subset \{1,\ldots ,n\} \atop |I|=k}\mathbf {1} _{A_{I} } \qquad \textbf{(4)}$$ <a id="math_4"></a> for indicator functions}@}, where: {@{$$A_{I}=\bigcap _{i\in I}A_{i}.$$}@} The following function {@{$$\left(\mathbf {1} _{A}-\mathbf {1} _{A_{1} }\right)\left(\mathbf {1} _{A}-\mathbf {1} _{A_{2} }\right)\cdots \left(\mathbf {1} _{A}-\mathbf {1} _{A_{n} }\right)=0,$$}@} is {@{identically zero}@} because: if {@{_x_ is not in _A_}@}, then {@{all factors are 0−0 = 0}@}; and otherwise, {@{if _x_ does belong to some _A<sub>m</sub>_, then the corresponding _m_<sup>th</sup> factor is 1−1=0}@}. By {@{expanding the product on the left-hand side}@}, {@{equation (__[4](#math_4)__) follows}@}. <!--SR:!2025-12-18,337,351!2025-12-28,346,351!2026-03-12,316,260!2027-06-04,723,331!2025-12-23,341,351!2025-11-18,312,340!2028-08-29,1104,351!2025-12-26,345,351!2028-01-09,905,330!2025-09-30,25,381!2025-09-29,24,381-->

To {@{prove the inclusion–exclusion principle for the cardinality of sets}@}, {@{sum the equation (__[4](#math_4)__) over all _x_ in the union of _A_<sub>1</sub>, ..., _A<sub>n</sub>_}@}. To {@{derive the version used in probability}@}, {@{take the [expectation](expected%20value.md) in (__[4](#math_4)__)}@}. In general, {@{[integrate](lebesgue%20integral.md) the equation (__[4](#math_4)__) with respect to _μ_}@}. Always {@{use linearity}@} in these derivations. <!--SR:!2026-01-03,352,351!2028-04-18,990,340!2025-11-22,316,340!2025-12-09,328,340!2028-07-03,1058,351!2025-11-16,308,330-->

## see also

- [Boole's inequality](Boole's%20inequality.md) – ::@:: Inequality applying to probability spaces <!--SR:!2025-10-01,258,331!2025-12-31,349,351-->
- [combinatorial principles](combinatorial%20principles.md) – ::@:: Methods used in combinatorics <!--SR:!2025-11-15,307,330!2025-12-22,341,351-->
- [maximum-minimums identity](maximum-minimums%20identity.md) – ::@:: Relates the maximum element of a set of numbers and the minima of its non-empty subsets <!--SR:!2028-08-16,1094,351!2025-11-04,298,330-->
- [necklace problem](necklace%20problem.md)
- [pigeonhole principle](pigeonhole%20principle.md) – ::@:: If there are more items than boxes holding them, one box must contain at least two items <!--SR:!2025-11-19,313,340!2025-12-29,347,351-->
- [Schuette–Nesbitt formula](Schuette–Nesbitt%20formula.md) – ::@:: mathematical formula in probability theory <!--SR:!2026-10-16,499,300!2028-04-01,953,330-->

## notes

1. [Roberts & Tesman 2009](#CITEREFRobertsTesman2009), pg. 405 <a id="^ref-1"></a>^ref-1
2. [Mazur 2010](#CITEREFMazur2010), pg. 94 <a id="^ref-2"></a>^ref-2
3. [van Lint & Wilson 1992](#CITEREFvan%20LintWilson1992), pg. 77 <a id="^ref-3"></a>^ref-3
4. [van Lint & Wilson 1992](#CITEREFvan%20LintWilson1992), pg. 77 <a id="^ref-4"></a>^ref-4
5. [Stanley 1986](#CITEREFStanley1986), pg. 64 <a id="^ref-5"></a>^ref-5
6. Rota, Gian-Carlo (1964), "On the foundations of combinatorial theory I. Theory of Möbius functions", _Zeitschrift für Wahrscheinlichkeitstheorie und Verwandte Gebiete_, __2__ (4): 340–368, [doi](digital%20object%20identifier.md):[10.1007/BF00531932](https://doi.org/10.1007%2FBF00531932), [S2CID](Semantic%20Scholar.md#S2CID) [121334025](https://api.semanticscholar.org/CorpusID:121334025) <a id="^ref-6"></a>^ref-6
7. [Brualdi 2010](#CITEREFBrualdi2010), pp. 167–8 <a id="^ref-7"></a>^ref-7
8. [Cameron 1994](#CITEREFCameron1994), pg. 78 <a id="^ref-8"></a>^ref-8
9. [Graham, Grötschel & Lovász 1995](#CITEREFGrahamGr%C3%B6tschelLov%C3%A1sz1995), pg. 1049 <a id="^ref-9"></a>^ref-9
10. [van Lint & Wilson 1992](#CITEREFvan%20LintWilson1992), pp. 77-8 <a id="^ref-10"></a>^ref-10
11. [Björklund, Husfeldt & Koivisto 2009](#CITEREFBj%C3%B6rklundHusfeldtKoivisto2009) <a id="^ref-11"></a>^ref-11
12. [Gross 2008](#CITEREFGross2008), pp. 211–13 <a id="^ref-12"></a>^ref-12
13. [Gross 2008](#CITEREFGross2008), pp. 208–10 <a id="^ref-13"></a>^ref-13
14. [Mazur 2010](#CITEREFMazur2010), pp.84-5, 90 <a id="^ref-14"></a>^ref-14
15. [Brualdi 2010](#CITEREFBrualdi2010), pp. 177–81 <a id="^ref-15"></a>^ref-15
16. [Brualdi 2010](#CITEREFBrualdi2010), pp. 282–7 <a id="^ref-16"></a>^ref-16
17. [Roberts & Tesman 2009](#CITEREFRobertsTesman2009), pp.419–20 <a id="^ref-17"></a>^ref-17
18. [van Lint & Wilson 1992](#CITEREFvan%20LintWilson1992), pg. 73 <a id="^ref-18"></a>^ref-18
19. ([Fernández, Fröhlich & Alan D. 1992](#CITEREFFern%C3%A1ndezFr%C3%B6hlichAlan%20D.1992), Proposition 12.6) <a id="^ref-19"></a>^ref-19

## references

This text incorporates [content](https://en.wikipedia.org/wiki/inclusion–exclusion_principle) from [Wikipedia](Wikipedia.md) available under the [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/) license.

- <a id="CITEREFAllenbySlomson2010"></a> Allenby, R.B.J.T.; Slomson, Alan \(2010\), [_How to Count: An Introduction to Combinatorics_](http://www.crcpress.com/product/isbn/9781420082609), Discrete Mathematics and Its Applications \(2 ed.\), CRC Press, pp. 51–60, [ISBN](ISBN.md) [9781420082609](https://en.wikipedia.org/wiki/Special:BookSources/9781420082609)
- <a id="CITEREFBjörklundHusfeldtKoivisto2009"></a> Björklund, A.; Husfeldt, T.; Koivisto, M. \(2009\), "Set partitioning via inclusion–exclusion", _[SIAM Journal on Computing](SIAM%20Journal%20on%20Computing.md)_, __39__ \(2\): 546–563, [CiteSeerX](CiteSeerX.md) [10.1.1.526.9573](https://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.526.9573), [doi](digital%20object%20identifier.md):[10.1137/070683933](https://doi.org/10.1137%2F070683933)
- <a id="CITEREFBrualdi2010"></a> Brualdi, Richard A. \(2010\), _Introductory Combinatorics_ \(5th ed.\), Prentice–Hall, [ISBN](ISBN.md) [9780136020400](https://en.wikipedia.org/wiki/Special:BookSources/9780136020400)
- <a id="CITEREFCameron1994"></a> Cameron, Peter J. \(1994\), _Combinatorics: Topics, Techniques, Algorithms_, Cambridge University Press, [ISBN](ISBN.md) [0-521-45761-0](https://en.wikipedia.org/wiki/Special:BookSources/0-521-45761-0)
- <a id="CITEREFFernándezFröhlichAlan D.1992"></a> Fernández, Roberto; [Fröhlich, Jürg](Jürg%20Fröhlich.md); [Alan D., Sokal](Alan%20Sokal.md) \(1992\), _Random Walks, Critical Phenomena, and Triviality in Quantum Field Theory_, Texts an Monographs in Physics, Berlin: [Springer-Verlag](Springer%20Science+Business%20Media.md#history), pp. xviii+444, [ISBN](ISBN.md) [3-540-54358-9](https://en.wikipedia.org/wiki/Special:BookSources/3-540-54358-9), [MR](Mathematical%20Reviews.md) [1219313](https://mathscinet.ams.org/mathscinet-getitem?mr=1219313), [Zbl](ZbMATH%20Open.md) [0761.60061](https://zbmath.org/?format=complete&q=an:0761.60061)
- <a id="CITEREFGrahamGrötschelLovász1995"></a> Graham, R.L.; [Grötschel, M.](Martin%20Grötschel.md); Lovász, L. \(1995\), _Hand Book of Combinatorics \(volume-2\)_, MIT Press – North Holland, [ISBN](ISBN.md) [9780262071710](https://en.wikipedia.org/wiki/Special:BookSources/9780262071710)
- <a id="CITEREFGross2008"></a> Gross, Jonathan L. \(2008\), _Combinatorial Methods with Computer Applications_, Chapman&Hall/CRC, [ISBN](ISBN.md) [9781584887430](https://en.wikipedia.org/wiki/Special:BookSources/9781584887430)
- ["Inclusion-and-exclusion principle"](https://www.encyclopediaofmath.org/index.php?title=Inclusion-and-exclusion_principle), _[Encyclopedia of Mathematics](Encyclopedia%20of%20Mathematics.md)_, [EMS Press](European%20Mathematical%20Society.md), 2001 \[1994\]
- <a id="CITEREFMazur2010"></a> Mazur, David R. \(2010\), _Combinatorics A Guided Tour_, The Mathematical Association of America, [ISBN](ISBN.md) [9780883857625](https://en.wikipedia.org/wiki/Special:BookSources/9780883857625)
- <a id="CITEREFRobertsTesman2009"></a> Roberts, Fred S.; Tesman, Barry \(2009\), _Applied Combinatorics_ \(2nd ed.\), CRC Press, [ISBN](ISBN.md) [9781420099829](https://en.wikipedia.org/wiki/Special:BookSources/9781420099829)
- <a id="CITEREFStanley1986"></a> Stanley, Richard P. \(1986\), _Enumerative Combinatorics Volume I_, Wadsworth & Brooks/Cole, [ISBN](ISBN.md) [0534065465](https://en.wikipedia.org/wiki/Special:BookSources/0534065465)
- <a id="CITEREFvan LintWilson1992"></a> van Lint, J.H.; Wilson, R.M. \(1992\), _A Course in Combinatorics_, Cambridge University Press, [ISBN](ISBN.md) [0521422604](https://en.wikipedia.org/wiki/Special:BookSources/0521422604)

_This article incorporates material from principle of inclusion–exclusion on [PlanetMath](PlanetMath.md), which is licensed under the [Creative Commons Attribution/Share-Alike License](https://en.wikipedia.org/wiki/Wikipedia:Text%20of%20the%20Creative%20Commons%20Attribution-ShareAlike%204.0%20International%20License)._
