---
name: Core workflows
description: Common command-line workflows for regenerating content, ingesting Wikipedia, packaging, and publishing
applyTo: "**"
---

# Core Workflows

**Tooling & pnpm wrappers:** Prefer `pnpm` script wrappers when available. Check `package.json` for repository scripts and prefer `pnpm run <script>` from the repository root to ensure project-local tools and the lockfile are used. When no pnpm wrapper exists for an operation, run the underlying command shown below (for example, `uv run -m init generate`). Always run `pnpm install` before using `pnpm run`.

> **Agent note:** the commands listed in this document describe human
> workflows and tool capabilities.  Agents should **not** itself invoke
> `init generate` or similar commands when editing content, since
> generation is handled automatically by the build/CI pipelines.

Important: `pnpm install` triggers the `prepare` script which runs `uv sync --all-extras --dev` to install Python development extras declared in `pyproject.toml`'s `[dependency-groups].dev` using the project's `uv.lock`. For CI and deterministic installs prefer `uv sync --locked --all-extras --dev`. `pyproject.toml` is the canonical source for Python dependency metadata in this repository; keep it up-to-date and add dev-only tools there rather than in a `requirements.txt` file.

Agent quickstart note: Agents should consult `.github/instructions/agent-quickstart.instructions.md` for a one-page checklist (startup commands, test/format sequence, and quick gotchas such as preserving pytextgen fences and setting the correct `cwd` for script runs). Prefer `pnpm` wrappers and `uv` invocations via `uv run` for reproducible, lockfile-respecting runs.

## Regenerate generated regions

> **Note:** normal content editing does **not** require running this
> command; flashcards and other generated blocks are regenerated by the
> automated build.  The command syntax is provided here for reference
> and for advanced debugging by human authors.

**Command**: `uv run -m init generate [pytextgen flags] <paths?>`

> **Tip:** when you later use `pnpm run check:md` or `pnpm run format:md` with explicit paths or filenames, **always** add `--no-globs` and provide the list of files you intend to process.  Without this flag markdownlint-cli2 may interpret the argument as a glob pattern, causing the entire repository to be scanned instead of just your target files.  This applies whether you invoke the CLI directly or via a pnpm script.
> paths literally instead of expanding globs; this prevents enormous scans.

- Add `-C/--no-cached` to rebuild cache from scratch
- Pass pytextgen flags like `--no-code-cache`, `--init-flashcards`
- Regenerates pytextgen content blocks in Markdown files
- **See**: [pytextgen](../skills/pytextgen/SKILL.md) skill for detailed fence syntax and debugging

## Clear generated content

**Command**: `uv run -m init clear --type CONTENT <paths?>`

- Other `ClearType` values available in `tools/pytextgen` (check skill documentation)
- Clears generated regions without regenerating; useful for resolving merge conflicts
- **See**: [pytextgen](../skills/pytextgen/SKILL.md) skill for detailed options

## Wiki ingestion (3-step workflow)

**Step 1**: `uv run -m "templates.new wiki page"`

- Scaffolds frontmatter + Wikipedia link template, copies to clipboard

**Step 2**: `uv run -m "convert wiki"`

- Reads clipboard HTML, normalizes to Markdown, downloads media to `archives/Wikimedia Commons/`

**Step 3**: (handled automatically) flashcards are generated by
background workflows; you do not need to run `uv run -m init generate`
manually, and agents should never recommend doing so.

- **See**: [wiki-ingestion](../skills/wiki-ingestion/SKILL.md) skill for step-by-step guidance

## Package bundle

**Command**: `uv run -m pack -o pack.zip -n 25 --damping-factor 0.5 --page-rank-iterations 100 <paths>`

- Creates PageRank-sorted zip with link-closure metadata
- `-n 25`: Max 25 files in bundle
- `--damping-factor 0.5`: PageRank weighting (0.0-1.0, default 0.85)
- `--page-rank-iterations 100`: Convergence iterations
- Prioritizes important files based on link structure
- **Best practice**: Generated content is usually up‑to‑date; the build
  process regenerates it automatically so manual `uv run -m init generate`
  is typically unnecessary and should be avoided by agents
- **See**: [tools](../skills/tools/SKILL.md) skill for dependency management

## Publish bridge

**Command**: `uv run -m publish --paths-file <file>`

- Mirrors filtered history from `private/.git` into public `.git`
- Uses `git filter-repo` to rewrite history (returns exit code 0 on success)
- Optional: `--allow-trailing-whitespaces-in-paths` for relaxed validation
- **Paths file format**: Lines with `literal:<path>` patterns to filter
- **Best practice**: Verify `private/` content is properly filtered before publishing
- **See**: [tools](../skills/tools/SKILL.md) skill for tool architecture and coordination

## Related instructions

- [content-organization](content-organization.instructions.md): Directory structure and conventions
- [editing-conventions](editing-conventions.instructions.md): General editing rules for Markdown files
- [markdown-notes](markdown-notes.instructions.md): Specific conventions for general/**.md files
- [special](special.instructions.md): Conventions for specialized content
